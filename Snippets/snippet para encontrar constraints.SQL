--####################################################
--### PROCURA CONSTRAINTS EM TODO O BANCO DE DADOS ###
--####################################################

--(versao Will)
SELECT
	ACC.TABLE_NAME,
	ACC.COLUMN_NAME,
	ACC.CONSTRAINT_NAME,
	AC.OWNER,
	/* REFERENCED PK */
	AC.R_OWNER,
	C_PK.TABLE_NAME AS R_TABLE_NAME,
	C_PK.CONSTRAINT_NAME AS R_PK
FROM
	ALL_CONS_COLUMNS ACC
JOIN
	ALL_CONSTRAINTS AC ON ACC.OWNER = AC.OWNER	AND ACC.CONSTRAINT_NAME = AC.CONSTRAINT_NAME
JOIN
	ALL_CONSTRAINTS C_PK ON AC.R_OWNER = C_PK.OWNER AND AC.R_CONSTRAINT_NAME = C_PK.CONSTRAINT_NAME
WHERE
	AC.CONSTRAINT_TYPE = 'R' /*P = PRIMARY KEY, R = FOREIGN KEY, U = UNIQUE KEY, C = CHECK*/
AND
	ACC.CONSTRAINT_NAME = 'FK_ACIDENTE_COD_PARTE_ATINGIDA'

--(versao Jhonny)
SELECT
--	ACC.*,
	ACC.CONSTRAINT_NAME,
	ACC.TABLE_NAME,
	ACC.COLUMN_NAME,
	AC.R_CONSTRAINT_NAME,
	AC.TABLE_NAME,
	C_PK.TABLE_NAME,
	C_PK.INDEX_NAME
FROM
	ALL_CONS_COLUMNS ACC
	JOIN ALL_CONSTRAINTS AC ON ACC.OWNER = AC.OWNER	AND ACC.CONSTRAINT_NAME = AC.CONSTRAINT_NAME
	JOIN ALL_CONSTRAINTS C_PK ON AC.R_OWNER = C_PK.OWNER AND AC.R_CONSTRAINT_NAME = C_PK.CONSTRAINT_NAME
WHERE
	ACC.OWNER = 'SGI'

--MAIS LEGÍVEL
SELECT
	C_PK.TABLE_NAME AS TABELA_MAE,
	C_PK.INDEX_NAME AS PRIMARY_KEY,
	ACC.TABLE_NAME AS TABELA_FILHA,
	ACC.COLUMN_NAME AS COLUNA_CONTENDO_FK,
	ACC.CONSTRAINT_NAME AS FOREIGN_KEY
FROM
	ALL_CONS_COLUMNS ACC
	JOIN ALL_CONSTRAINTS AC ON ACC.OWNER = AC.OWNER	AND ACC.CONSTRAINT_NAME = AC.CONSTRAINT_NAME
	JOIN ALL_CONSTRAINTS C_PK ON AC.R_OWNER = C_PK.OWNER AND AC.R_CONSTRAINT_NAME = C_PK.CONSTRAINT_NAME
WHERE
	ACC.OWNER = 'SGI'
	AND C_PK.INDEX_NAME = 'RH_LOCAL_REPARTICAO_PK'
ORDER BY
	C_PK.TABLE_NAME