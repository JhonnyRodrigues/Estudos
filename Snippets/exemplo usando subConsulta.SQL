SELECT
	NOME_FUNCIONARIO AS "NOME FUNCIONÁRIO",
	MATRICULA_FUNCIONAL AS "MATRÍCULA",
	TO_CHAR(PERIODO_AQUISITIVO_ANTIGO, 'DD/MM') AS "PERÍODO ANTIGO",	
	TO_CHAR(PERIODO_AQUISITIVO_ATUAL, 'DD/MM') "PERÍODO ATUAL"
FROM 		(
				SELECT 		ID,
							--DESCRIPTION,
							USERNAME,
							SUBSTR(DESCRIPTION,31,(COALESCE (INSTR(DESCRIPTION, '|'), 31) - 31)) AS COD_FUNC,						
							CASE 
									WHEN INSTR(DESCRIPTION,'DT_PERIODO_AQUISITIVO (old)  : |') <> 0 THEN TO_DATE('1888-01-01', 'YYYY-MM-DD') 
									ELSE
										TO_DATE(
											SUBSTR(
												DESCRIPTION ,
												 (
												 	INSTR(
												 		DESCRIPTION,
												 		'DT_PERIODO_AQUISITIVO (old)  : '
												 	) + 31
												 ),
												10
											) ,
											'YYYY-MM-DD'
										)											
							END AS PERIODO_AQUISITIVO_ANTIGO,
							CASE 
								WHEN INSTR(DESCRIPTION,'DT_PERIODO_AQUISITIVO (new)  : |') <> 0 THEN TO_DATE('1888-01-01', 'YYYY-MM-DD') 
								ELSE 
									TO_DATE(
										SUBSTR(
											DESCRIPTION,
											(
											 	INSTR(
											 		DESCRIPTION,
											 		'DT_PERIODO_AQUISITIVO (new)  : '
											 	) + 31
											 ),
											10
										) ,
										'YYYY-MM-DD') 
							END AS PERIODO_AQUISITIVO_ATUAL
				FROM SEGURANCA_LOG S
				WHERE 
					ACTION = 'update'
				AND
					APPLICATION = 'RH_FUNCIONARIOS'
				AND
					INSERTED_DATE BETWEEN TO_DATE('01-06-2022', 'DD-MM-YYYY') AND TO_DATE('19-12-2022', 'DD-MM-YYYY')
				AND
					DESCRIPTION LIKE '%DT_PERIODO_AQUISITIVO%'
), RH_FUNCIONARIOS
WHERE 			
	EXTRACT(MONTH FROM PERIODO_AQUISITIVO_ANTIGO) <> EXTRACT(MONTH FROM PERIODO_AQUISITIVO_ATUAL) 
AND 
	EXTRACT(DAY FROM PERIODO_AQUISITIVO_ANTIGO) <> EXTRACT(DAY FROM PERIODO_AQUISITIVO_ATUAL)
AND
	TO_NUMBER(COD_FUNC) = COD_FUNCIONARIO
ORDER BY
	ID;